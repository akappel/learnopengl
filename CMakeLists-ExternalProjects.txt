include(ExternalProject)

set(GLEW_PROJ_PREFIX ${THIRD_PARTY_PATH}/glew-2.0.0)
set(GLFW_PROJ_PREFIX ${THIRD_PARTY_PATH}/glfw-3.2.1)

### GLEW
ExternalProject_Add(
  glew
  URL "https://github.com/nigels-com/glew/releases/download/glew-2.0.0/glew-2.0.0.tgz"

  PREFIX ${GLEW_PROJ_PREFIX}
  SOURCE_SUBDIR build/cmake

  # Run under release because of error in GLEW's cmake:
  # https://github.com/nigels-com/glew/issues/99
  CMAKE_ARGS -DCMAKE_BUILD_TYPE=Release

  # we don't want cmake doing any of the building for this one
  INSTALL_COMMAND ""
)

add_custom_command(
  TARGET glew
  POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy ${GLEW_PROJ_PREFIX}/src/glew-build/lib/Release/glew32.lib ${THIRD_PARTY_LIB}/glew32.lib
)

add_custom_command(
  TARGET glew
  POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy_directory ${GLEW_PROJ_PREFIX}/src/glew/include/GL ${THIRD_PARTY_INCLUDE}/GL
)

### GLFW
ExternalProject_Add(
  glfw
  GIT_REPOSITORY "https://github.com/glfw/glfw.git"
  GIT_TAG "3.2.1"

  CMAKE_ARGS -DCMAKE_BUILD_TYPE=Release

  PREFIX ${GLFW_PROJ_PREFIX}
  INSTALL_COMMAND ""
)

add_custom_command(
  TARGET glfw
  POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy ${GLFW_PROJ_PREFIX}/src/glfw-build/src/Release/glfw3.lib ${THIRD_PARTY_LIB}/glfw3.lib
)

add_custom_command(
  TARGET glfw
  POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy_directory ${GLFW_PROJ_PREFIX}/src/glfw/include/GLFW ${THIRD_PARTY_INCLUDE}/GLFW
)
